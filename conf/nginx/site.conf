server_tokens off;
 

## internal vhost: do NOT redirect requests arriving from non-matching hosts (used by tunnel/mpdf)
server {
    # make this the default server for port 80 so requests that don't match the public
    # server_name (for example connections via the docker host port mapping) are
    # handled here and not redirected to the public HTTPS site.
    listen 80 default_server;
    listen [::]:80 default_server;
    index index.html index.php;
    error_log  /var/log/nginx/error.log;
    access_log /var/log/nginx/access.log;

    root /var/www/html;

    include /etc/nginx/conf.d/server_name.active;

    # other configs
    include /etc/nginx/conf.d/site-enabled-http/*;

    # intentionally do NOT redirect these default/internal calls (reverse tunnel / mpdf)
}

# public vhost: keep the redirect to HTTPS for external clients
server {
    listen 80;
    listen [::]:80;
    index index.html index.php;
    error_log  /var/log/nginx/error.log;
    access_log /var/log/nginx/access.log;
    
    root /var/www/html;
    
    include /etc/nginx/conf.d/server_name.active;
    
    # other configs
    include /etc/nginx/conf.d/site-enabled-http/*;

    return         301 https://$server_name$request_uri;
    
}

server {
    listen      443           ssl;
    listen [::]:443           ssl;
    http2  on;
	
    index index.html index.php;

    root /var/www/html/;
    
    include /etc/nginx/conf.d/server_name.active;

    include /etc/nginx/conf.d/snippets/header.snippet;

    include /etc/nginx/conf.d/snippets/sslconf.snippet;

    error_log                 /var/log/nginx/error.log;
    access_log                /var/log/nginx/access.log;

    # other configs
    include /etc/nginx/conf.d/site-enabled-https/*;
}

server {
    # this vhost is for internal connections only (e.g. mpdf fetches images from here, see env WEB_HOST)
    listen 8080;
    
    root /var/www/html/fewohbee/public;
    
    include /etc/nginx/conf.d/server_name.active;    
}